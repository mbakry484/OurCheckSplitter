<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OurCheckSplitter API Tester</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background: #f8fafc; }
        .card { margin-bottom: 2rem; }
        .section-title { margin-bottom: 1rem; }
        .api-response {
            background: #f1f3f5;
            padding: 1rem;
            border-radius: 8px;
            font-family: 'Segoe UI', Arial, sans-serif;
            font-size: 1rem;
            color: #222;
        }
        .kv-table {
            width: 100%;
            border-collapse: collapse;
        }
        .kv-table th, .kv-table td {
            padding: 6px 12px;
            border-bottom: 1px solid #e2e2e2;
        }
        .kv-table th {
            background: #e9ecef;
            font-weight: 600;
        }
        .kv-table tr:last-child td {
            border-bottom: none;
        }
        .list-group-item {
            background: #fff;
            border: 1px solid #e2e2e2;
            border-radius: 6px;
            margin-bottom: 4px;
        }
    </style>
</head>
<body>
<div class="container py-4">
    <h1 class="mb-4 text-center">OurCheckSplitter API Tester</h1>
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title section-title">Friends</h5>
                    <form id="createFriendForm" class="mb-2">
                        <input type="text" class="form-control mb-2" placeholder="Friend Name" id="friendName" required>
                        <button class="btn btn-primary w-100" type="submit">Create Friend</button>
                    </form>
                    <button class="btn btn-secondary w-100 mb-2" onclick="getAllFriends()">Get All Friends</button>
                    <input type="number" class="form-control mb-2" placeholder="Friend ID" id="friendId">
                    <button class="btn btn-info w-100 mb-2" onclick="getFriendById()">Get Friend By ID</button>
                    <button class="btn btn-warning w-100 mb-2" onclick="editFriend()">Edit Friend</button>
                    <button class="btn btn-danger w-100 mb-2" onclick="deleteFriend()">Delete Friend</button>
                    <div id="friendsResponse" class="api-response mt-2"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title section-title">Final Amounts</h5>
                    <input type="number" class="form-control mb-2" placeholder="Receipt ID" id="faReceiptId">
                    <button class="btn btn-primary w-100 mb-2" onclick="getFriendAmounts()">Get Friend Amounts</button>
                    <input type="number" class="form-control mb-2" placeholder="Friend ID" id="faFriendId">
                    <input type="number" class="form-control mb-2" placeholder="Paid Amount" id="faPaidAmount">
                    <button class="btn btn-success w-100 mb-2" onclick="calculateChange()">Calculate Change</button>
                    <div id="finalAmountResponse" class="api-response mt-2"></div>
                </div>
            </div>
        </div>
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title section-title">Receipts</h5>
                    <form id="createReceiptForm" class="mb-2">
                        <input type="text" class="form-control mb-2" placeholder="Receipt Name" id="receiptName" required>
                        <button class="btn btn-primary w-100" type="submit">Create Receipt</button>
                    </form>
                    <button class="btn btn-secondary w-100 mb-2" onclick="getAllReceipts()">Get All Receipts</button>
                    <input type="number" class="form-control mb-2" placeholder="Receipt ID" id="receiptId">
                    <button class="btn btn-info w-100 mb-2" onclick="getReceiptById()">Get Receipt By ID</button>
                    <button class="btn btn-warning w-100 mb-2" onclick="editReceipt()">Edit Receipt</button>
                    <button class="btn btn-danger w-100 mb-2" onclick="deleteReceipt()">Delete Receipt</button>
                    <hr>
                    <h6>Add Item to Receipt</h6>
                    <input type="number" class="form-control mb-2" placeholder="Receipt ID" id="addItemReceiptId">
                    <input type="text" class="form-control mb-2" placeholder="Item Name" id="itemName">
                    <input type="number" class="form-control mb-2" placeholder="Item Price" id="itemPrice">
                    <button class="btn btn-success w-100 mb-2" onclick="addItemToReceipt()">Add Item</button>
                    <div id="receiptsResponse" class="api-response mt-2"></div>
                </div>
            </div>
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title section-title">Assignments</h5>
                    <h6>Assign Friends to Receipt</h6>
                    <input type="number" class="form-control mb-2" placeholder="Receipt ID" id="assignFriendsReceiptId">
                    <input type="text" class="form-control mb-2" placeholder="Friend IDs (comma separated)" id="assignFriendIds">
                    <button class="btn btn-primary w-100 mb-2" onclick="assignFriendsToReceipt()">Assign Friends</button>
                    <h6>Assign Items to Receipt</h6>
                    <input type="text" class="form-control mb-2" placeholder="Item IDs (comma separated)" id="assignItemIds">
                    <button class="btn btn-success w-100 mb-2" onclick="assignItemsToReceipt()">Assign Items</button>
                    <h6>Assign Friends to Items</h6>
                    <input type="text" class="form-control mb-2" placeholder="Friend IDs (comma separated)" id="assignFriendsToItemsFriendIds">
                    <input type="text" class="form-control mb-2" placeholder="Item IDs (comma separated)" id="assignFriendsToItemsItemIds">
                    <button class="btn btn-info w-100 mb-2" onclick="assignFriendsToItems()">Assign Friends to Items</button>
                    <h6>Assign Friends to Whole Item</h6>
                    <input type="text" class="form-control mb-2" placeholder="Friend IDs (comma separated)" id="assignFriendsToWholeItemFriendIds">
                    <input type="number" class="form-control mb-2" placeholder="Item ID" id="assignFriendsToWholeItemItemId">
                    <button class="btn btn-warning w-100 mb-2" onclick="assignFriendsToWholeItem()">Assign Friends to Whole Item</button>
                    <div id="assignmentsResponse" class="api-response mt-2"></div>
                </div>
            </div>
        </div>
    </div>
</div>
<script>
const apiBase = '/api';
function showResponse(section, data) {
    const container = document.getElementById(section + 'Response');
    container.innerHTML = renderObject(data);
}

function renderObject(obj) {
    if (typeof obj === 'string') {
        return `<div class="text-danger">${obj}</div>`;
    }
    if (obj == null) {
        return `<div class="text-muted">No data</div>`;
    }
    if (Array.isArray(obj)) {
        if (obj.length === 0) return `<div class="text-muted">No items</div>`;
        return `<ul class="list-group">${obj.map(item => `<li class="list-group-item">${renderObject(item)}</li>`).join('')}</ul>`;
    }
    if (typeof obj === 'object') {
        let rows = '';
        for (const key in obj) {
            if (obj.hasOwnProperty(key)) {
                let value = obj[key];
                if (typeof value === 'object' && value !== null) {
                    value = renderObject(value);
                } else {
                    value = `<span>${value}</span>`;
                }
                rows += `<tr><th>${key}</th><td>${value}</td></tr>`;
            }
        }
        return `<table class="kv-table">${rows}</table>`;
    }
    return `<span>${obj}</span>`;
}

// Friends
document.getElementById('createFriendForm').onsubmit = async (e) => {
    e.preventDefault();
    const name = document.getElementById('friendName').value;
    const res = await fetch(`${apiBase}/friends`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name })
    });
    showResponse('friends', await res.json());
};
async function getAllFriends() {
    const res = await fetch(`${apiBase}/friends`);
    showResponse('friends', await res.json());
}
async function getFriendById() {
    const id = document.getElementById('friendId').value;
    if (!id) return showResponse('friends', 'Enter Friend ID');
    const res = await fetch(`${apiBase}/friends/${id}`);
    showResponse('friends', await res.json());
}
async function editFriend() {
    const id = document.getElementById('friendId').value;
    const name = document.getElementById('friendName').value;
    if (!id || !name) return showResponse('friends', 'Enter Friend ID and Name');
    const res = await fetch(`${apiBase}/friends/${id}`, {
        method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name })
    });
    showResponse('friends', await res.json());
}
async function deleteFriend() {
    const id = document.getElementById('friendId').value;
    if (!id) return showResponse('friends', 'Enter Friend ID');
    const res = await fetch(`${apiBase}/friends/${id}`, { method: 'DELETE' });
    showResponse('friends', await res.json());
}

// Receipts
document.getElementById('createReceiptForm').onsubmit = async (e) => {
    e.preventDefault();
    const name = document.getElementById('receiptName').value;
    const res = await fetch(`${apiBase}/receipts`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name })
    });
    showResponse('receipts', await res.json());
};
async function getAllReceipts() {
    const res = await fetch(`${apiBase}/receipts`);
    showResponse('receipts', await res.json());
}
async function getReceiptById() {
    const id = document.getElementById('receiptId').value;
    if (!id) return showResponse('receipts', 'Enter Receipt ID');
    const res = await fetch(`${apiBase}/receipts/${id}`);
    showResponse('receipts', await res.json());
}
async function editReceipt() {
    const id = document.getElementById('receiptId').value;
    const name = document.getElementById('receiptName').value;
    if (!id || !name) return showResponse('receipts', 'Enter Receipt ID and Name');
    const res = await fetch(`${apiBase}/receipts/${id}`, {
        method: 'PUT', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name })
    });
    showResponse('receipts', await res.json());
}
async function deleteReceipt() {
    const id = document.getElementById('receiptId').value;
    if (!id) return showResponse('receipts', 'Enter Receipt ID');
    const res = await fetch(`${apiBase}/receipts/${id}`, { method: 'DELETE' });
    showResponse('receipts', await res.json());
}
async function addItemToReceipt() {
    const receiptId = document.getElementById('addItemReceiptId').value;
    const name = document.getElementById('itemName').value;
    const price = document.getElementById('itemPrice').value;
    if (!receiptId || !name || !price) return showResponse('receipts', 'Enter Receipt ID, Item Name, and Price');
    const res = await fetch(`${apiBase}/receipts/${receiptId}/items`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ name, price: parseFloat(price) })
    });
    showResponse('receipts', await res.json());
}

// Assignments
async function assignFriendsToReceipt() {
    const receiptId = document.getElementById('assignFriendsReceiptId').value;
    const friendIds = document.getElementById('assignFriendIds').value.split(',').map(x => parseInt(x.trim())).filter(x => x);
    if (!receiptId || friendIds.length === 0) return showResponse('assignments', 'Enter Receipt ID and Friend IDs');
    const res = await fetch(`${apiBase}/receipts/${receiptId}/assign-friends`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ friendIds })
    });
    showResponse('assignments', await res.json());
}
async function assignItemsToReceipt() {
    const itemIds = document.getElementById('assignItemIds').value.split(',').map(x => parseInt(x.trim())).filter(x => x);
    if (itemIds.length === 0) return showResponse('assignments', 'Enter Item IDs');
    const res = await fetch(`${apiBase}/receipts/assign-items`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ itemIds })
    });
    showResponse('assignments', await res.json());
}
async function assignFriendsToItems() {
    const friendIds = document.getElementById('assignFriendsToItemsFriendIds').value.split(',').map(x => parseInt(x.trim())).filter(x => x);
    const itemIds = document.getElementById('assignFriendsToItemsItemIds').value.split(',').map(x => parseInt(x.trim())).filter(x => x);
    if (friendIds.length === 0 || itemIds.length === 0) return showResponse('assignments', 'Enter Friend IDs and Item IDs');
    const res = await fetch(`${apiBase}/receipts/assign-friends-to-items`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ friendIds, itemIds })
    });
    showResponse('assignments', await res.json());
}
async function assignFriendsToWholeItem() {
    const friendIds = document.getElementById('assignFriendsToWholeItemFriendIds').value.split(',').map(x => parseInt(x.trim())).filter(x => x);
    const itemId = document.getElementById('assignFriendsToWholeItemItemId').value;
    if (friendIds.length === 0 || !itemId) return showResponse('assignments', 'Enter Friend IDs and Item ID');
    const res = await fetch(`${apiBase}/receipts/assign-friends-to-whole-item`, {
        method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({ friendIds, itemId: parseInt(itemId) })
    });
    showResponse('assignments', await res.json());
}

// Final Amounts
async function getFriendAmounts() {
    const receiptId = document.getElementById('faReceiptId').value;
    if (!receiptId) return showResponse('finalAmount', 'Enter Receipt ID');
    const res = await fetch(`${apiBase}/finalamount/${receiptId}`);
    showResponse('finalAmount', await res.json());
}
async function calculateChange() {
    const receiptId = document.getElementById('faReceiptId').value;
    const friendId = document.getElementById('faFriendId').value;
    const paidAmount = document.getElementById('faPaidAmount').value;
    if (!receiptId || !friendId || !paidAmount) return showResponse('finalAmount', 'Enter Receipt ID, Friend ID, and Paid Amount');
    const res = await fetch(`${apiBase}/finalamount/calculate-change?receiptId=${receiptId}&friendId=${friendId}&paidAmount=${paidAmount}`);
    showResponse('finalAmount', await res.json());
}
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
